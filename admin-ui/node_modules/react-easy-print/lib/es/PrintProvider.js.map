{"version":3,"sources":["../../src/PrintProvider.jsx"],"names":["React","ReactDOM","PropTypes","spliced","debug","propTypes","loose","bool","children","node","isRequired","invert","childContextTypes","printProvider","shape","regPrintable","func","unregPrintable","isPrint","PrintProvider","props","state","isInPrintPreview","printableNodes","printableRegistry","window","matchMedia","onchange","matches","setState","hasSingle","bind","document","body","classList","add","s","hiddenAll","remove","key","isSingle","single","main","undefined","setTimeout","concat","length","hideAll","console","warn","Error","Object","assign","unhideAll","el","createElement","id","appendChild","render","printRender","getElementById","removeChild","Children","map","child","cloneElement","createRender","deleteRender","loose_","invert_","wrap","PureComponent"],"mappings":"y9CAAA,MAAOA,MAAP,KAAkB,OAAlB,CACA,MAAOC,SAAP,KAAqB,WAArB,CACA,MAAOC,UAAP,KAAsB,YAAtB,C,i2BAEA,OAASC,OAAT,CAAkBC,KAAlB,KAA+B,UAA/B,CAEA,MAAO,IAAMC,WAAY,CACvBC,MAAOJ,UAAUK,IADM,CAEvBC,SAAUN,UAAUO,IAAV,CAAeC,UAFF,CAGvBC,OAAQT,UAAUK,IAHK,CAAlB,CAMP,MAAO,IAAMK,mBAAoB,CAC/BC,cAAeX,UAAUY,KAAV,CAAgB,CAC7BC,aAAcb,UAAUc,IAAV,CAAeN,UADA,CAE7BO,eAAgBf,UAAUc,IAAV,CAAeN,UAFF,CAG7BQ,QAAShB,UAAUK,IAAV,CAAeG,UAHK,CAAhB,EAIZA,UAL4B,CAA1B,C,GAQcS,c,8EACnB,uBAAYC,KAAZ,CAAmB,yJACXA,KADW,GAEjB,MAAKC,KAAL,CAAa,CACXC,iBAAkB,KADP,CAEXC,eAAgB,EAFL,CAAb,CAIA,MAAKC,iBAAL,CAAyB,EAAzB,CACAC,OAAOC,UAAP,CAAkB,OAAlB,EAA2BC,QAA3B,CAAsC,UAAM,CAC1CvB,MAAM,mBAAN,CAA2BqB,OAAOC,UAAP,CAAkB,OAAlB,EAA2BE,OAAtD,EACA,MAAKC,QAAL,CAAc,CAAEP,iBAAkBG,OAAOC,UAAP,CAAkB,OAAlB,EAA2BE,OAA/C,CAAd,CACD,CAHD,CAKA,MAAKE,SAAL,CAAiB,KAAjB,CAZiB,YAalB,C,mFAEiB,CAChB,MAAO,CACLjB,cAAe,CACbK,QAASO,OAAOC,UAAP,CAAkB,OAAlB,EAA2BE,OADvB,CAEbb,aAAc,KAAKA,YAAL,CAAkBgB,IAAlB,CAAuB,IAAvB,CAFD,CAGbd,eAAgB,KAAKA,cAAL,CAAoBc,IAApB,CAAyB,IAAzB,CAHH,CADV,CAOR,CAED;yCACU,CACRC,SAASC,IAAT,CAAcC,SAAd,CAAwBC,GAAxB,CAA4BC,EAAEC,SAA9B,EACA,KAAKP,SAAL,CAAiB,IAClB,C,6CAEW,CACVE,SAASC,IAAT,CAAcC,SAAd,CAAwBI,MAAxB,CAA+BF,EAAEC,SAAjC,EACA,KAAKP,SAAL,CAAiB,KAClB,C,kDAEYS,G,CAAK9B,I,CAAM,iBACtB,GAAMH,OAAQ,KAAKc,KAAL,CAAWd,KAAX,EAAoB,KAAKc,KAAL,CAAWT,MAA7C,CACA,GAAM6B,UAAW/B,KAAKW,KAAL,CAAWqB,MAAX,EAAqBhC,KAAKW,KAAL,CAAWsB,IAAjD,CAFsB,GAGdZ,UAHc,CAGA,IAHA,CAGdA,SAHc,CAKtB1B,MAAM,eAAN,CAAuBmC,GAAvB,CAA4B9B,IAA5B,EAEA,GAAI,KAAKe,iBAAL,CAAuBe,GAAvB,IAAgCI,SAAhC,EAA6CrC,KAAjD,CAAwD,OACxDsC,WAAW,iBAAM,QAAKf,QAAL,CAAc,CAC7BN,eAAgB,OAAKF,KAAL,CAAWE,cAAX,CAA0BsB,MAA1B,CAAiCpC,IAAjC,CADa,CAAd,CAAN,CAAX,CAEI,CAFJ,EAGA,KAAKe,iBAAL,CAAuBe,GAAvB,EAA8B,KAAKlB,KAAL,CAAWE,cAAX,CAA0BuB,MAAxD,CAEA,GAAIN,UAAY,CAACV,SAAjB,CAA4B,CAC1B,KAAKiB,OAAL,EACD,CAFD,IAEM,IAAGP,QAAH,CAAY,CAChBQ,QAAQC,IAAR,CAAa,GAAIC,MAAJ,CAAU,oFAAV,CAAb,CACD,CACF,C,sDAEcX,G,CAAKC,Q,CAAU,CAC5B,GAAMlC,OAAQ,KAAKc,KAAL,CAAWd,KAAX,EAAoB,KAAKc,KAAL,CAAWT,MAA7C,CACA,GAAI,KAAKa,iBAAL,CAAuBe,GAAvB,IAAgCI,SAAhC,EAA6C,KAAKtB,KAAL,CAAWC,gBAAxD,EAA4EhB,KAAhF,CAAuF,OACvF,KAAKuB,QAAL,CAAc,CACZN,eAAgBpB,QAAQ,KAAKkB,KAAL,CAAWE,cAAnB,CAAmC,KAAKC,iBAAL,CAAuBe,GAAvB,CAAnC,CADJ,CAAd,EAGA,KAAKf,iBAAL,CAAyB2B,OAAOC,MAAP,CAAc,EAAd,CAAkB,KAAK5B,iBAAvB,oBAA6Ce,GAA7C,CAAmDI,SAAnD,EAAzB,CACA,GAAIH,QAAJ,CAAc,CACZ,KAAKa,SAAL,EACD,CACF,C,kDAEY7C,Q,CAAU,CACrB,GAAM8C,IAAKtB,SAASuB,aAAT,CAAuB,KAAvB,CAAX,CACAD,GAAGE,EAAH,CAAQ,QAAR,CACAxB,SAASC,IAAT,CAAcwB,WAAd,CAA0BH,EAA1B,EAEArD,SAASyD,MAAT,CAAgB,2BAAK,UAAWtB,EAAEuB,WAAlB,EAAiCnD,QAAjC,CAAhB,CAAkE8C,EAAlE,CACD,C,mDAEc,CACb,GAAMA,IAAKtB,SAAS4B,cAAT,CAAwB,QAAxB,CAAX,CACAN,IAAMtB,SAASC,IAAT,CAAc4B,WAAd,CAA0BP,EAA1B,CACP,C,uCAEQ,4BACsC,KAAKjC,KAD3C,CACCC,gBADD,QACCA,gBADD,CACmBC,cADnB,QACmBA,cADnB,CAEP,GAAMjB,OAAQ,KAAKc,KAAL,CAAWd,KAAX,EAAoB,KAAKc,KAAL,CAAWT,MAA7C,CAFO,GAGCmB,UAHD,CAGe,IAHf,CAGCA,SAHD,CAKP,GAAIR,kBAAoBC,eAAeuB,MAAnC,EAA6C,CAACxC,KAA9C,EAAuD,CAACwB,SAA5D,CAAuE,CACrE1B,MAAM,uBAAN,CAA+BmB,cAA/B,EACA,GAAMf,UAAWR,MAAM8D,QAAN,CAAeC,GAAf,CAAmBxC,cAAnB,CAAmC,SAACyC,KAAD,CAAOzB,GAAP,CAAe,CACjE,MAAOvC,OAAMiE,YAAN,CAAmBD,KAAnB,CAA0B,CAAEzB,OAAF,CAA1B,CACR,CAFgB,CAAjB,CAIA,KAAK2B,YAAL,CAAkB,+BAAM1D,QAAN,CAAlB,CACD,CACDoC,WAAW,iBAAM,QAAKuB,YAAL,EAAN,CAAX,CAAsC,CAAtC,EAEA/D,MAAM,mBAAN,CAA2BkB,gBAA3B,CAA6CC,eAAeuB,MAA5D,CAAoE,CAACxC,KAArE,EACA,GAAM8D,QAAS9D,MAAQ8B,EAAE9B,KAAV,CAAkB,EAAjC,CACA,GAAM+D,SAAU,KAAKjD,KAAL,CAAWT,MAAX,CAAoByB,EAAEzB,MAAtB,CAA+B,EAA/C,CACA,MAAO,4BAAK,UAAcyB,EAAEkC,IAAhB,KAAwBF,MAAxB,KAAkCC,OAAlC,IAAL,EAAoD,KAAKjD,KAAL,CAAWZ,QAA/D,CACR,C,0BArGwCR,MAAMuE,a,gBAA5BpD,c,CAwGrBA,cAAcP,iBAAd,CAAkCA,iBAAlC","file":"PrintProvider.js","sourcesContent":["import React from 'react';\nimport ReactDOM from 'react-dom';\nimport PropTypes from 'prop-types';\nimport s from './PrintProvider.css';\nimport { spliced, debug } from './common';\n\nexport const propTypes = {\n  loose: PropTypes.bool,\n  children: PropTypes.node.isRequired,\n  invert: PropTypes.bool,\n};\n\nexport const childContextTypes = {\n  printProvider: PropTypes.shape({\n    regPrintable: PropTypes.func.isRequired,\n    unregPrintable: PropTypes.func.isRequired,\n    isPrint: PropTypes.bool.isRequired,\n  }).isRequired,\n};\n\nexport default class PrintProvider extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      isInPrintPreview: false,\n      printableNodes: [],\n    };\n    this.printableRegistry = {};\n    window.matchMedia('print').onchange = () => {\n      debug('toggle print mode', window.matchMedia('print').matches);\n      this.setState({ isInPrintPreview: window.matchMedia('print').matches });\n    };\n\n    this.hasSingle = false;\n  }\n\n  getChildContext() {\n    return {\n      printProvider: {\n        isPrint: window.matchMedia('print').matches,\n        regPrintable: this.regPrintable.bind(this),\n        unregPrintable: this.unregPrintable.bind(this),\n      },\n    };\n  }\n\n  // hideAll - is being used to cover all of React Portals, popups and modals and etc.\n  hideAll() {\n    document.body.classList.add(s.hiddenAll);\n    this.hasSingle = true;\n  }\n\n  unhideAll() {\n    document.body.classList.remove(s.hiddenAll);\n    this.hasSingle = false;\n  }\n\n  regPrintable(key, node) {\n    const loose = this.props.loose || this.props.invert;\n    const isSingle = node.props.single || node.props.main;\n    const { hasSingle } = this;\n\n    debug('reg printable', key, node);\n\n    if (this.printableRegistry[key] !== undefined || loose) return;\n    setTimeout(() => this.setState({\n      printableNodes: this.state.printableNodes.concat(node),\n    }), 0);\n    this.printableRegistry[key] = this.state.printableNodes.length;\n\n    if (isSingle && !hasSingle) {\n      this.hideAll();\n    }else if(isSingle){\n      console.warn(new Error('react-easy-print warning \\n\\t you\\'re using more than one `single` Print component'));\n    }\n  }\n\n  unregPrintable(key, isSingle) {\n    const loose = this.props.loose || this.props.invert;\n    if (this.printableRegistry[key] === undefined || this.state.isInPrintPreview || loose) return;\n    this.setState({\n      printableNodes: spliced(this.state.printableNodes, this.printableRegistry[key]),\n    });\n    this.printableRegistry = Object.assign({}, this.printableRegistry, { [key]: undefined });\n    if (isSingle) {\n      this.unhideAll();\n    }\n  }\n\n  createRender(children) {\n    const el = document.createElement('div');\n    el.id = 'render';\n    document.body.appendChild(el);\n\n    ReactDOM.render(<div className={s.printRender} >{children}</div>, el);\n  }\n\n  deleteRender() {\n    const el = document.getElementById('render');\n    el && document.body.removeChild(el);\n  }\n\n  render() {\n    const { isInPrintPreview, printableNodes } = this.state;\n    const loose = this.props.loose || this.props.invert;\n    const { hasSingle } = this;\n\n    if (isInPrintPreview && printableNodes.length && !loose && !hasSingle) {\n      debug('render printable only', printableNodes);\n      const children = React.Children.map(printableNodes, (child,key) => {\n        return React.cloneElement(child, { key });\n      });\n\n      this.createRender(<div>{children}</div>);\n    }\n    setTimeout(() => this.deleteRender(), 0);\n\n    debug('render everything', isInPrintPreview, printableNodes.length, !loose);\n    const loose_ = loose ? s.loose : '';\n    const invert_ = this.props.invert ? s.invert : '';\n    return <div className={`${s.wrap} ${loose_} ${invert_} `}>{this.props.children}</div>;\n  }\n}\nPrintProvider.propTypes = propTypes;\nPrintProvider.childContextTypes = childContextTypes;\n"]}